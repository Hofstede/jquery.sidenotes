(function(){var t=[].slice;(function(e){var i,o,s,n;e.fn.extend({sidenotes:function(){var i,o;o=arguments[0],i=2<=arguments.length?t.call(arguments,1):[];return this.each(function(){var t,n,r;t=e(this);n=(r=t.data("sidenotes"))!=null?r:t.data("sidenotes",new s(this,o));if(typeof o==="string"){n[o].apply(n,i);if(o==="destroy"){t.removeData("sidenotes")}}return true})}});s=function(){t.prototype.options={footnoteContainerSelector:".footnotes",footnoteSelector:"> ol > li",initiallyHidden:false,removeRefMarkRegex:/(?!)/,refMarkClass:"ref-mark",sidenoteClass:"sidenote",sidenoteGroupClass:"sidenote-group",sidenoteElement:"aside",sidenoteGroupElement:"div",sidenotePlacement:"before",hideFootnoteContainer:true,formatSidenote:function(t,i,o){var s;s=e("<"+this.sidenoteElement+"/>",{"class":this.sidenoteClass}).html(t).attr("id",i);if(o!=null){s.prepend(e("<span/>",{"class":this.refMarkClass,"data-ref":o}).html(o))}return s},formatSidenoteID:function(t){return t.replace(/^f/,"s")},hide:function(t){return t.hide()},show:function(t){return t.show()}};function t(t,s){var n,r,h;e.extend(this.options,s);this.$postContainer=e(t);if(this.options.hideFootnoteContainer){this.$footnoteContainer=e(this.options.footnoteContainerSelector,this.$postContainer)}this.$footnoteContainer=this.$footnoteContainer.size()!==0?this.$footnoteContainer:null;n=e(this.options.footnoteContainerSelector+" "+this.options.footnoteSelector,this.$postContainer);this.sidenotesAfterRef=this.options.sidenotePlacement==="after";h=1;this.sidenotes=[];this.groups=[];r=this;n.each(function(){var t,e,s,n,f,a,p;t=this;e=t.id;n=r.options.removeRefMarkRegex.test(e);a=new i(t,n?null:h++,r);r.sidenotes.push(a);f=(p=r.sidenotes[r.sidenotes.length-2])!=null?p:null;if(f!=null?f.$pivot.is(a.$pivot):void 0){if(f.hasGroup()){return f.group.push(a)}else{s=new o([f,a],r);return r.groups.push(s)}}});this.isHidden=this.options.initiallyHidden;if(!this.isHidden){this.show(true)}}t.prototype.show=function(t){var e,i,o,s,n,r,h,f;if(this.isHidden||t){h=this.sidenotes;for(o=0,n=h.length;o<n;o++){i=h[o];if(t&&!i.hasGroup()){i.$pivot[this.sidenotePlacement()](i.$sidenote)}i.show()}f=this.groups;for(s=0,r=f.length;s<r;s++){e=f[s];if(t){e.$pivot[this.sidenotePlacement()](e.$group)}e.show()}if(this.$footnoteContainer!=null&&this.options.hideFootnoteContainer){this.options.hide(this.$footnoteContainer)}return this.isHidden=false}};t.prototype.hide=function(t){var e,i,o,s,n,r,h,f;if(!this.isHidden||t){h=this.sidenotes;for(o=0,n=h.length;o<n;o++){i=h[o];i.hide()}f=this.groups;for(s=0,r=f.length;s<r;s++){e=f[s];e.hide()}if(this.$footnoteContainer!=null){this.options.show(this.$footnoteContainer)}return this.isHidden=true}};t.prototype.sidenotePlacement=function(t,e){var i,o,s,n,r,h,f,a;if((t==="before"||t==="after")&&(t!==this.sidenotePlacement()||e)){f=this.sidenotes;for(s=0,r=f.length;s<r;s++){o=f[s];if(!o.hasGroup()){o.$pivot[t](o.$sidenote)}}a=this.groups;for(n=0,h=a.length;n<h;n++){i=a[n];i.$pivot[t](i.$group)}return this.sidenotesAfterRef=t==="after"}else{if(this.sidenotesAfterRef){return"after"}else{return"before"}}};t.prototype.destroy=function(){var t,e,i,o,s,n,r,h,f;this.hide();r=this.sidenotes;for(i=0,s=r.length;i<s;i++){e=r[i];e.$sidenote.remove()}h=this.groups;f=[];for(o=0,n=h.length;o<n;o++){t=h[o];f.push(t.$group.remove())}return f};return t}();i=function(){function t(t,i,o){var s;this.$footnote=e(t);this.owner=o;this.footnoteID=t.id;this.sidenoteID=this.owner.options.formatSidenoteID(this.footnoteID);this.ref=i>0?i:null;this.$refMarkAnchor=e("a[href='#"+n(this.footnoteID)+"']",this.owner.$postContainer);this.$refMarkSup=this.$refMarkAnchor.parent("sup");this.$refMarkSup=this.$refMarkSup.size()!==0?this.$refMarkSup:null;this.refMarkID=this.refMark().attr("id");this.originalRef=this.$refMarkAnchor.html();this.$sidenote=this.owner.options.formatSidenote(this.$footnote.html(),this.sidenoteID,this.ref);this.$pivot=this.refMark().parentsUntil(this.owner.$postContainer).last();this.group=null;s=e("a[href='#"+n(this.refMarkID)+"']",this.$sidenote);if(this.noMark()){this.owner.options.hide(this.refMark());if(s!=null){this.owner.options.hide(s)}}this.owner.options.hide(this.$sidenote);this.isHidden=true}t.prototype.noMark=function(){return this.ref==null};t.prototype.hasGroup=function(){return this.group!=null};t.prototype.show=function(t){if(this.isHidden||t){if(this.noMark()){this.owner.options.hide(this.refMark())}else{this.$refMarkAnchor.html(this.ref);this.$refMarkAnchor.attr("href","#"+this.sidenoteID)}this.owner.options.show(this.$sidenote);this.owner.options.hide(this.$footnote);return this.isHidden=false}};t.prototype.hide=function(t){if(!this.isHidden||t){this.$refMarkAnchor.html(this.originalRef);this.$refMarkAnchor.attr("href","#"+this.footnoteID);this.owner.options.show(this.refMark());this.owner.options.hide(this.$sidenote);this.owner.options.show(this.$footnote);return this.isHidden=true}};t.prototype.refMark=function(){var t;return(t=this.$refMarkSup)!=null?t:this.$refMarkAnchor};return t}();o=function(){function t(t,i){var o;this.sidenotes=[];this.owner=i;this.$group=e("<"+this.owner.options.sidenoteGroupElement+"/>",{"class":this.owner.options.sidenoteGroupClass});this.push(t);this.$pivot=(o=this.sidenotes[0])!=null?o.$pivot:void 0;this.owner.options.hide(this.$group);this.isHidden=true}t.prototype.push=function(t){var e,i,o,s,n;i=t instanceof Array?t:[t];(n=this.sidenotes).push.apply(n,i);for(o=0,s=i.length;o<s;o++){e=i[o];this.$group.append(e.$sidenote);e.group=this}return this.$pivot!=null?this.$pivot:this.$pivot=this.sidenotes[0].pivot};t.prototype.show=function(){if(this.isHidden){this.owner.options.show(this.$group);return this.isHidden=false}};t.prototype.hide=function(){if(!this.isHidden){this.owner.options.hide(this.$group);return this.isHidden=true}};return t}();return n=function(t){return t.replace(/([#;&,\.\+\*\~':"\!\^$\[\]\(\)=>\|])/g,"\\$1")}})(jQuery)}).call(this);