(function(){var t=[].slice;(function(e,i,o){var n,s,r,h;e.fn.extend({sidenotes:function(){var i,o;o=arguments[0],i=2<=arguments.length?t.call(arguments,1):[];return this.each(function(){var t,n,s;t=e(this);n=(s=t.data("sidenotes"))!=null?s:t.data("sidenotes",new r(this,o));if(typeof o==="string"){n[o].apply(n,i);if(o==="destroy"){t.removeData("sidenotes")}}return true})}});r=function(){t.prototype.options={footnoteContainerSelector:".footnotes",footnoteSelector:"> ol > li",initiallyHidden:false,removeRefMarkRegex:/(?!)/,refMarkClass:"ref-mark",sidenoteClass:"sidenote",sidenoteGroupClass:"sidenote-group",sidenoteElement:"aside",sidenoteGroupElement:"div",sidenotePlacement:"before",hideFootnoteContainer:true,formatSidenote:function(t,i,o){var n;n=e("<"+this.sidenoteElement+"/>",{"class":this.sidenoteClass}).html(t).attr("id",i);if(o!=null){n.prepend(e("<span/>",{"class":this.refMarkClass,"data-ref":o}).html(o))}return n},formatSidenoteID:function(t){return t.replace(/^f/,"s")},hide:function(t){return t.hide()},show:function(t){return t.show()}};function t(t,i){var o,r,h;this.options=e.extend({},this.options,i);this.options.sidenotePlacement=this.options.placement||this.options.sidenotePlacement;this.$postContainer=e(t);if(this.options.hideFootnoteContainer){this.$footnoteContainer=e(this.options.footnoteContainerSelector,this.$postContainer)}this.$footnoteContainer=this.$footnoteContainer.size()!==0?this.$footnoteContainer:null;o=e(this.options.footnoteContainerSelector+" "+this.options.footnoteSelector,this.$postContainer);this.sidenotesAfterRef=this.options.sidenotePlacement==="after";h=1;this.sidenotes=[];this.groups=[];r=this;o.each(function(){var t,e,i,o,f,a,p;t=this;e=t.id;o=r.options.removeRefMarkRegex.test(e);a=new n(t,o?null:h++,r);r.sidenotes.push(a);f=(p=r.sidenotes[r.sidenotes.length-2])!=null?p:null;if(f!=null?f.$pivot.is(a.$pivot):void 0){if(f.hasGroup()){return f.group.push(a)}else{i=new s([f,a],r);return r.groups.push(i)}}});this.isHidden=this.options.initiallyHidden;if(this.isHidden){this.hide(true)}else{this.show(true)}}t.prototype.show=function(t){var e,i,o,n,s,r,h,f;if(this.isHidden||t){h=this.sidenotes;for(o=0,s=h.length;o<s;o++){i=h[o];if(t&&!i.hasGroup()){i.$pivot[this.sidenotePlacement()](i.$sidenote)}i.show()}f=this.groups;for(n=0,r=f.length;n<r;n++){e=f[n];if(t){e.$pivot[this.sidenotePlacement()](e.$group)}e.show()}if(this.$footnoteContainer!=null&&this.options.hideFootnoteContainer){this.options.hide(this.$footnoteContainer)}return this.isHidden=false}};t.prototype.hide=function(t){var e,i,o,n,s,r,h,f;if(!this.isHidden||t){h=this.sidenotes;for(o=0,s=h.length;o<s;o++){i=h[o];if(t&&!i.hasGroup()){i.$pivot[this.sidenotePlacement()](i.$sidenote)}i.hide()}f=this.groups;for(n=0,r=f.length;n<r;n++){e=f[n];if(t){e.$pivot[this.sidenotePlacement()](e.$group)}e.hide()}if(this.$footnoteContainer!=null){this.options.show(this.$footnoteContainer)}return this.isHidden=true}};t.prototype.sidenotePlacement=function(t,e){var i,o,n,s,r,h,f,a;if((t==="before"||t==="after")&&(t!==this.sidenotePlacement()||e)){f=this.sidenotes;for(n=0,r=f.length;n<r;n++){o=f[n];if(!o.hasGroup()){o.$pivot[t](o.$sidenote)}}a=this.groups;for(s=0,h=a.length;s<h;s++){i=a[s];i.$pivot[t](i.$group)}return this.sidenotesAfterRef=t==="after"}else{if(this.sidenotesAfterRef){return"after"}else{return"before"}}};t.prototype.placement=function(t,e){return this.sidenotePlacement(t,e)};t.prototype.destroy=function(){var t,e,i,o,n,s,r,h,f;this.hide();r=this.sidenotes;for(i=0,n=r.length;i<n;i++){e=r[i];e.$sidenote.remove()}h=this.groups;f=[];for(o=0,s=h.length;o<s;o++){t=h[o];f.push(t.$group.remove())}return f};return t}();n=function(){function t(t,i,o){var n;this.$footnote=e(t);this.owner=o;this.footnoteID=t.id;this.sidenoteID=this.owner.options.formatSidenoteID(this.footnoteID);this.ref=i>0?i:null;this.$refMarkAnchor=e("a[href='#"+h(this.footnoteID)+"']",this.owner.$postContainer);this.$refMarkSup=this.$refMarkAnchor.parent("sup");this.$refMarkSup=this.$refMarkSup.size()!==0?this.$refMarkSup:null;this.refMarkID=this.refMark().attr("id");this.originalRef=this.$refMarkAnchor.html();this.$sidenote=this.owner.options.formatSidenote(this.$footnote.html(),this.sidenoteID,this.ref);this.$pivot=this.refMark().parentsUntil(this.owner.$postContainer).last();this.group=null;n=e("a[href='#"+h(this.refMarkID)+"']",this.$sidenote);if(this.noMark()){this.owner.options.hide(this.refMark());if(n!=null){this.owner.options.hide(n)}}this.owner.options.hide(this.$sidenote);this.isHidden=true}t.prototype.noMark=function(){return this.ref==null};t.prototype.hasGroup=function(){return this.group!=null};t.prototype.show=function(t){if(this.isHidden||t){if(this.noMark()){this.owner.options.hide(this.refMark())}else{this.$refMarkAnchor.html(this.ref);this.$refMarkAnchor.attr("href","#"+this.sidenoteID)}this.owner.options.show(this.$sidenote);this.owner.options.hide(this.$footnote);return this.isHidden=false}};t.prototype.hide=function(t){if(!this.isHidden||t){this.$refMarkAnchor.html(this.originalRef);this.$refMarkAnchor.attr("href","#"+this.footnoteID);this.owner.options.show(this.refMark());this.owner.options.hide(this.$sidenote);this.owner.options.show(this.$footnote);return this.isHidden=true}};t.prototype.refMark=function(){var t;return(t=this.$refMarkSup)!=null?t:this.$refMarkAnchor};return t}();s=function(){function t(t,i){var o;this.sidenotes=[];this.owner=i;this.$group=e("<"+this.owner.options.sidenoteGroupElement+"/>",{"class":this.owner.options.sidenoteGroupClass});this.push(t);this.$pivot=(o=this.sidenotes[0])!=null?o.$pivot:void 0;this.owner.options.hide(this.$group);this.isHidden=true}t.prototype.push=function(t){var e,i,o,n,s;i=t instanceof Array?t:[t];(s=this.sidenotes).push.apply(s,i);for(o=0,n=i.length;o<n;o++){e=i[o];this.$group.append(e.$sidenote);e.group=this}return this.$pivot!=null?this.$pivot:this.$pivot=this.sidenotes[0].pivot};t.prototype.show=function(){if(this.isHidden){this.owner.options.show(this.$group);return this.isHidden=false}};t.prototype.hide=function(){if(!this.isHidden){this.owner.options.hide(this.$group);return this.isHidden=true}};return t}();return h=function(t){return t.replace(/([#;&,\.\+\*\~':"\!\^$\[\]\(\)=>\|])/g,"\\$1")}})(jQuery,window,document)}).call(this);